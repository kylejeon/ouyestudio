import{r as x,j as e}from"./index-DGyQ0dU-.js";function ee(u,j){let S=null;return(...N)=>{S&&clearTimeout(S),S=setTimeout(()=>u(...N),j)}}const Z=x.forwardRef(({photos:u,texts:j,layout:S,isTextMode:N,onAddText:r,onUpdatePhoto:T,onUpdateText:f,showGuides:k=!0},D)=>{const F=x.useRef(null),[U,C]=x.useState(!1),[z,L]=x.useState(null),[$,Y]=x.useState({x:0,y:0}),[X,V]=x.useState(new Map),[B,O]=x.useState(!1),[_,J]=x.useState(!1),n=x.useRef(null);x.useEffect(()=>{(async()=>{try{await document.fonts.ready,J(!0)}catch(a){console.error("í°íŠ¸ ë¡œë”© ì˜¤ë¥˜:",a),J(!0)}})()},[]);const t=S.id==="horizontal-2",m=t?2400:1600,l=t?1600:2400,y=()=>{const s=window.innerWidth<640,a=window.innerWidth<1024;if(s){const i=Math.min(window.innerWidth*.9,320);return t?{width:i,height:i*2/3}:{width:i,height:i*3/2}}else return a?t?{width:600,height:400}:{width:320,height:480}:t?{width:600,height:400}:{width:400,height:600}},[v,g]=x.useState(y());x.useEffect(()=>{const s=()=>{g(y())};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[t]),x.useEffect(()=>{g(y())},[t]),x.useEffect(()=>{const s=async()=>{const a=new Map;for(const i of u)if(X.has(i.id))a.set(i.id,X.get(i.id));else try{const o=new Image;o.crossOrigin="anonymous",await new Promise((d,c)=>{o.onload=()=>d(),o.onerror=()=>c(),o.src=i.src}),a.set(i.id,o)}catch{console.error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:",i.src)}V(a)};u.length>0?s():V(new Map)},[u]);const A=x.useCallback(async()=>{if(!(B||!F.current||!_)){O(!0);try{const s=F.current,a=s.getContext("2d");if(!a)return;s.width=m,s.height=l,a.fillStyle="#ffffff",a.fillRect(0,0,s.width,s.height),k&&(a.strokeStyle="#e5e7eb",a.lineWidth=2,S.slots.forEach(i=>{const o=i.x*m,d=i.y*l,c=i.width*m,I=i.height*l;a.strokeRect(o,d,c,I)}));for(const i of u){const o=X.get(i.id);if(o&&o.complete){a.save();const d=i.slotX*m,c=i.slotY*l,I=i.slotWidth*m,E=i.slotHeight*l;a.beginPath(),a.rect(d,c,I,E),a.clip();const W=d+I/2+i.x*I,P=c+E/2+i.y*E;a.translate(W,P),a.rotate(i.rotation*Math.PI/180);const R=o.width,G=o.height,Q=R*i.scale,q=G*i.scale;a.imageSmoothingEnabled=i.scale<1,a.imageSmoothingQuality=i.scale<1?"low":"high",a.drawImage(o,-Q/2,-q/2,Q,q),a.restore()}}j.forEach(i=>{a.save();const o=i.x*m,d=i.y*l;a.translate(o,d);const c=i.fontFamily==="Arial"||i.fontFamily==="serif"||i.fontFamily==="sans-serif"?`"Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", ${i.fontFamily}`:`"${i.fontFamily}", "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Malgun Gothic", sans-serif`;if(t){a.font=`${i.fontSize*2}px ${c}`,a.fillStyle=i.color,a.textAlign="center",a.textBaseline="middle";const I=i.text.split(""),E=i.fontSize*2.4,W=-(I.length-1)*E/2;I.forEach((P,R)=>{a.fillText(P,0,W+R*E)})}else a.rotate(i.rotation*Math.PI/180),a.font=`${i.fontSize*2}px ${c}`,a.fillStyle=i.color,a.textAlign="center",a.textBaseline="middle",a.fillText(i.text,0,0);a.restore()})}catch(s){console.error("Canvas rendering error:",s)}finally{O(!1)}}},[u,j,S,X,B,k,t,m,l,_]),h=x.useCallback(ee(A,30),[A]);x.useEffect(()=>(h(),()=>{n.current&&clearTimeout(n.current)}),[h]);const M=s=>{if(!N)return;const a=F.current;if(!a)return;const i=a.getBoundingClientRect(),o=s.clientX-i.left,d=s.clientY-i.top;r(o,d)},p=s=>{const a=F.current;if(!a)return{x:0,y:0};const i=a.getBoundingClientRect();let o,d;if("touches"in s)if(s.touches.length>0)o=s.touches[0].clientX,d=s.touches[0].clientY;else if(s.changedTouches.length>0)o=s.changedTouches[0].clientX,d=s.changedTouches[0].clientY;else return{x:0,y:0};else o=s.clientX,d=s.clientY;return{x:(o-i.left)/i.width,y:(d-i.top)/i.height}},w=s=>{if(N)return;const a=F.current;if(!a)return;const i=a.getContext("2d");if(!i)return;const{x:o,y:d}=p(s);for(const c of j){const I=c.fontFamily==="Arial"||c.fontFamily==="serif"||c.fontFamily==="sans-serif"?`"Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", ${c.fontFamily}`:`"${c.fontFamily}", "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Malgun Gothic", sans-serif`;i.font=`${c.fontSize*2}px ${I}`;let E,W;if(t){const P=c.text.split(""),R=c.fontSize*2.4;E=(c.fontSize*2+80)/m,W=(P.length*R+80)/l}else E=(i.measureText(c.text).width+80)/m,W=(c.fontSize*2+80)/l;if(o>=c.x-E/2&&o<=c.x+E/2&&d>=c.y-W/2&&d<=c.y+W/2){C(!0),L({type:"text",id:c.id}),Y({x:o-c.x,y:d-c.y}),s.preventDefault();return}}for(const c of u){const I=c.slotX,E=c.slotY,W=c.slotWidth,P=c.slotHeight;if(o>=I&&o<=I+W&&d>=E&&d<=E+P){C(!0),L({type:"photo",id:c.id});const R=(o-I-W/2)/W,G=(d-E-P/2)/P;Y({x:R-c.x,y:G-c.y}),s.preventDefault();return}}},H=s=>{if(!U||!z)return;const{x:a,y:i}=p(s);if(z.type==="text"){const o=a-$.x,d=i-$.y;f(z.id,{x:Math.max(0,Math.min(1,o)),y:Math.max(0,Math.min(1,d))})}else if(z.type==="photo"){const o=u.find(W=>W.id===z.id);if(!o)return;const d=o.slotX,c=o.slotY,I=o.slotWidth,E=o.slotHeight;if(a>=d&&a<=d+I&&i>=c&&i<=c+E){const W=(a-d-I/2)/I,P=(i-c-E/2)/E,R=W-$.x,G=P-$.y;T(z.id,{x:Math.max(-1,Math.min(1,R)),y:Math.max(-1,Math.min(1,G))})}}s.preventDefault()},b=s=>{C(!1),L(null),Y({x:0,y:0}),s.preventDefault()};return e.jsxs("div",{className:"relative",children:[e.jsx("canvas",{ref:s=>{F.current=s,typeof D=="function"?D(s):D&&(D.current=s)},width:m,height:l,className:`border-2 border-gray-300 rounded-lg shadow-lg ${N?"cursor-crosshair":"cursor-move"}`,style:{width:`${v.width}px`,height:`${v.height}px`,touchAction:"none"},onClick:M,onMouseDown:w,onMouseMove:H,onMouseUp:b,onMouseLeave:b,onTouchStart:w,onTouchMove:H,onTouchEnd:b}),e.jsx("div",{className:"mt-2 text-sm text-gray-500 text-center",children:N?"í´ë¦­í•˜ì—¬ í…ìŠ¤íŠ¸ ì¶”ê°€":"ì‚¬ì§„ê³¼ í…ìŠ¤íŠ¸ë¥¼ ë“œëž˜ê·¸í•˜ì—¬ ìœ„ì¹˜ ì¡°ì •"})]})});Z.displayName="PhotoCanvas";function te({onUpload:u}){const j=x.useRef(null),S=f=>{const k=f.target.files;k&&k.length>0&&u(k)},N=f=>{f.preventDefault();const k=f.dataTransfer.files;k&&k.length>0&&u(k)},r=f=>{f.preventDefault()},T=()=>{j.current?.click()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onClick:T,onDrop:N,onDragOver:r,className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors cursor-pointer",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-12 h-12 mx-auto flex items-center justify-center bg-gray-100 rounded-full",children:e.jsx("i",{className:"ri-upload-cloud-2-line text-xl text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"ì‚¬ì§„ ì—…ë¡œë“œ"}),e.jsx("p",{className:"text-xs text-gray-500",children:"í´ë¦­í•˜ê±°ë‚˜ ë“œëž˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ"})]})]})}),e.jsx("input",{ref:j,type:"file",multiple:!0,accept:"image/*",onChange:S,className:"hidden"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("p",{children:"â€¢ JPG, PNG íŒŒì¼ ì§€ì›"}),e.jsx("p",{children:"â€¢ ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ ê°€ëŠ¥"}),e.jsx("p",{children:"â€¢ ì„ íƒí•œ ë ˆì´ì•„ì›ƒì— ë§žê²Œ ìžë™ ë°°ì¹˜"})]})]})}function se({layouts:u,selectedLayout:j,onLayoutChange:S}){return e.jsxs("div",{className:"space-y-3",children:[u.map(N=>e.jsx("button",{onClick:()=>S(N),className:`w-full p-3 rounded-lg border-2 transition-all whitespace-nowrap cursor-pointer ${j.id===N.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:N.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[N.slots.length,"ê°œ ìŠ¬ë¡¯"]})]}),e.jsx("div",{className:`bg-white border border-gray-300 rounded relative overflow-hidden ${N.id==="horizontal-2"?"w-12 h-8":"w-8 h-12"}`,children:N.slots.map((r,T)=>e.jsx("div",{className:"absolute bg-gray-200 border border-gray-400",style:{left:`${r.x*100}%`,top:`${r.y*100}%`,width:`${r.width*100}%`,height:`${r.height*100}%`}},T))})]})},N.id)),e.jsx("div",{className:"text-xs text-gray-500 mt-3",children:e.jsx("p",{children:"â€¢ ë ˆì´ì•„ì›ƒ ë³€ê²½ ì‹œ ê¸°ì¡´ ì‚¬ì§„ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤"})})]})}const ie=[{value:"Arial",label:"Arial"},{value:"Helvetica",label:"Helvetica"},{value:"Times New Roman",label:"Times New Roman"},{value:"Georgia",label:"Georgia"},{value:"Verdana",label:"Verdana"},{value:"Noto Sans KR",label:"ë…¸í†  ì‚°ìŠ¤"},{value:"Nanum Gothic",label:"ë‚˜ëˆ”ê³ ë”•"},{value:"Nanum Myeongjo",label:"ë‚˜ëˆ”ëª…ì¡°"},{value:"Nanum Pen Script",label:"ë‚˜ëˆ”íŽœìŠ¤í¬ë¦½íŠ¸"},{value:"Cute Font",label:"ííŠ¸í°íŠ¸"},{value:"Jua",label:"ì£¼ì•„"},{value:"Sunflower",label:"í•´ë°”ë¼ê¸°"},{value:"Gamja Flower",label:"ê°ìžê½ƒ"},{value:"Stylish",label:"ìŠ¤íƒ€ì¼ë¦¬ì‹œ"},{value:"Poor Story",label:"ê°€ë‚œí•œ ì´ì•¼ê¸°"},{value:"Gaegu",label:"ê°œêµ¬"},{value:"Do Hyeon",label:"ë„í˜„"},{value:"Black Han Sans",label:"ê²€ì€ê³ ë”•"},{value:"Song Myung",label:"ì†¡ëª…"},{value:"Yeon Sung",label:"ì—°ì„±"},{value:"Gowun Batang",label:"ê³ ìš´ë°”íƒ•ì²´"},{value:"Dongle",label:"ë™ê¸€"},{value:"Single Day",label:"ì‹±ê¸€ë°ì´"}],ae=["â™¡","â¤ï¸","ðŸ’™","â˜…","â˜†","â™ª","â™«","â™¬","â™©","â˜º","ðŸ˜Š","ðŸ˜","ðŸ˜˜","ðŸ˜Ž","ðŸ˜¢","ðŸ˜‚","â™ ","â™£","â™¦","â™§","â™¤","â™¢","â™›","â™š","â˜€","â˜","â˜‚","â˜ƒ","â„","âš¡","ðŸŒ™","â­","â†’","â†","â†‘","â†“","â†—","â†–","â†˜","â†™","âœ“","âœ—","âœ•","âœ–","â—‹","â—","â—¯","â—‰"];function ne({texts:u,onUpdateText:j,onDeleteText:S}){const N=(r,T)=>{const f=u.find(k=>k.id===r);f&&j(r,{text:f.text+T})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-700",children:"í…ìŠ¤íŠ¸ íŽ¸ì§‘"}),u.map((r,T)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["í…ìŠ¤íŠ¸ ",T+1]}),e.jsx("button",{onClick:()=>S(r.id),className:"text-red-500 hover:text-red-700 cursor-pointer",children:e.jsx("i",{className:"ri-delete-bin-line"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"ë‚´ìš©"}),e.jsx("input",{type:"text",value:r.text,onChange:f=>j(r.id,{text:f.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded",style:{fontFamily:r.fontFamily,fontVariantEmoji:"emoji"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"íŠ¹ìˆ˜ë¬¸ìž"}),e.jsx("div",{className:"grid grid-cols-8 gap-1 p-2 bg-white border border-gray-200 rounded max-h-24 overflow-y-auto",children:ae.map((f,k)=>e.jsx("button",{onClick:()=>N(r.id,f),className:"w-6 h-6 text-sm border border-gray-200 rounded hover:bg-blue-50 hover:border-blue-300 transition-colors cursor-pointer flex items-center justify-center",title:`íŠ¹ìˆ˜ë¬¸ìž ì¶”ê°€: ${f}`,style:{fontVariantEmoji:"emoji",fontFamily:"Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif"},children:f},k))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"í°íŠ¸"}),e.jsx("select",{value:r.fontFamily,onChange:f=>j(r.id,{fontFamily:f.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded pr-8",style:{fontFamily:r.fontFamily},children:ie.map(f=>e.jsx("option",{value:f.value,style:{fontFamily:f.value},children:f.label},f.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"ë¯¸ë¦¬ë³´ê¸°"}),e.jsx("div",{className:"w-full px-2 py-2 text-sm border border-gray-200 rounded bg-white",style:{fontFamily:r.fontFamily,fontSize:`${Math.min(r.fontSize,16)}px`,color:r.color,fontVariantEmoji:"emoji"},children:r.text||"í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-600 mb-1",children:["í¬ê¸°: ",r.fontSize,"px"]}),e.jsx("input",{type:"range",min:"12",max:"48",value:r.fontSize,onChange:f=>j(r.id,{fontSize:parseInt(f.target.value)}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"ìƒ‰ìƒ"}),e.jsx("input",{type:"color",value:r.color,onChange:f=>j(r.id,{color:f.target.value}),className:"w-full h-8 border border-gray-300 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-600 mb-1",children:["íšŒì „: ",r.rotation,"Â°"]}),e.jsx("input",{type:"range",min:"-180",max:"180",value:r.rotation,onChange:f=>j(r.id,{rotation:parseInt(f.target.value)}),className:"w-full"})]})]},r.id))]})}const K=[{id:"single",name:"1x1 (1ìž¥)",slots:[{x:.02,y:.02,width:.96,height:.96}]},{id:"vertical-2",name:"1x2 ì„¸ë¡œ (2ìž¥)",slots:[{x:.05,y:.025,width:.9,height:.41},{x:.05,y:.465,width:.9,height:.41}]},{id:"horizontal-2",name:"1x2 ê°€ë¡œ (2ìž¥)",slots:[{x:.025,y:.02,width:.4375,height:.96},{x:.4875,y:.02,width:.4375,height:.96}]},{id:"grid-4",name:"2x2 (4ìž¥)",slots:[{x:.025,y:.025,width:.4625,height:.4125},{x:.5125,y:.025,width:.4625,height:.4125},{x:.025,y:.4625,width:.4625,height:.4125},{x:.5125,y:.4625,width:.4625,height:.4125}]},{id:"grid-9",name:"3x3 (9ìž¥)",slots:[{x:.025,y:.025,width:.3,height:.27},{x:.35,y:.025,width:.3,height:.27},{x:.675,y:.025,width:.3,height:.27},{x:.025,y:.32,width:.3,height:.27},{x:.35,y:.32,width:.3,height:.27},{x:.675,y:.32,width:.3,height:.27},{x:.025,y:.615,width:.3,height:.27},{x:.35,y:.615,width:.3,height:.27},{x:.675,y:.615,width:.3,height:.27}]}];function le(){const[u,j]=x.useState([]),[S,N]=x.useState([]),[r,T]=x.useState(K[0]),[f,k]=x.useState(!1),D=x.useRef(null),F=x.useCallback(n=>{Array.from(n).forEach((t,m)=>{if(t.type.startsWith("image/")){const l=new FileReader;l.onload=y=>{const v=u.length,g=r.slots[v+m];if(g){const A=new Image;A.onload=()=>{let h=y.target?.result,M=A.width,p=A.height;if(r.id==="grid-9"){const b=document.createElement("canvas"),s=b.getContext("2d");if(s){let{width:o,height:d}=A;if(o>1200||d>1200){const c=Math.min(1200/o,1200/d);o=o*c,d=d*c}b.width=o,b.height=d,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(A,0,0,o,d),h=b.toDataURL("image/jpeg",.85),M=o,p=d}}let w;if(r.id==="single"){const a=g.width*1600,i=g.height*2400,o=a/M,d=i/p;w=Math.max(o,d)}else{const b=g.width/g.height;M/p>b?w=g.width*(r.id==="horizontal-2"?2400:1600)/M:w=g.height*(r.id==="horizontal-2"?1600:2400)/p}const H={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}-${m}`,src:h,x:0,y:0,width:g.width,height:g.height,rotation:0,scale:w,slotX:g.x,slotY:g.y,slotWidth:g.width,slotHeight:g.height};j(b=>[...b,H])},A.src=y.target?.result}},l.readAsDataURL(t)}})},[r,u.length]),U=x.useCallback((n,t)=>{const m={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:"í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš”",x:n!==void 0?n/(C?600:400):.5,y:t!==void 0?t/(C?400:600):.5,fontSize:30,fontFamily:"Arial",color:"#000000",rotation:0};N(l=>[...l,m])},[r]),C=r.id==="horizontal-2",z=x.useCallback((n,t)=>{j(m=>m.map(l=>l.id===n?{...l,...t}:l))},[]),L=x.useCallback(n=>{const t=u.find(l=>l.id===n);if(!t)return;const m=new Image;m.onload=()=>{let l=m.width,y=m.height;if(r.id==="grid-9"&&(m.width>1200||m.height>1200)){const h=Math.min(1200/m.width,1200/m.height);l=m.width*h,y=m.height*h}let v;if(r.id==="single"){const h=t.slotWidth*1600,M=t.slotHeight*2400,p=h/l,w=M/y;v=Math.max(p,w)}else{const g=t.slotWidth/t.slotHeight;l/y>g?v=t.slotWidth*(r.id==="horizontal-2"?2400:1600)/l:v=t.slotHeight*(r.id==="horizontal-2"?1600:2400)/y}z(n,{scale:v,x:0,y:0})},m.src=t.src},[u,r,z]),$=x.useCallback(n=>{const t=u.find(l=>l.id===n);if(!t)return;const m=u.map(l=>l.id!==n?{...l,scale:t.scale}:l);j(m)},[u]),Y=x.useCallback((n,t)=>{N(m=>m.map(l=>l.id===n?{...l,...t}:l))},[]),X=x.useCallback(n=>{j(t=>t.filter(m=>m.id!==n))},[]),V=x.useCallback(n=>{N(t=>t.filter(m=>m.id!==n))},[]),B=x.useCallback(n=>{T(n),j([]),N([])},[]),O=x.useCallback(()=>{if(D.current){const n=D.current,t=n.getContext("2d");if(!t)return;const m=t.getImageData(0,0,n.width,n.height),l=C?2400:1600,y=C?1600:2400;let v,g;C?(v=1600,g=2400):(v=l,g=y),n.width=v,n.height=g,t.clearRect(0,0,v,g),t.fillStyle="#ffffff",t.fillRect(0,0,v,g);const A=u.map(h=>new Promise(M=>{const p=new Image;p.onload=()=>{t.save(),C&&(t.translate(v/2,g/2),t.rotate(Math.PI/2),t.translate(-l/2,-y/2));const w=h.slotX*l,H=h.slotY*y,b=h.slotWidth*l,s=h.slotHeight*y;t.beginPath(),t.rect(w,H,b,s),t.clip();const a=w+b/2+h.x*b,i=H+s/2+h.y*s;t.translate(a,i),t.rotate(h.rotation*Math.PI/180);const o=p.width*h.scale,d=p.height*h.scale;t.drawImage(p,-o/2,-d/2,o,d),t.restore(),M()},p.onerror=()=>M(),p.src=h.src}));Promise.all(A).then(()=>{S.forEach(h=>{t.save(),C&&(t.translate(v/2,g/2),t.rotate(Math.PI/2),t.translate(-l/2,-y/2));const M=h.x*l,p=h.y*y;if(t.translate(M,p),C){t.font=`${h.fontSize*2}px ${h.fontFamily}, Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji`,t.fillStyle=h.color,t.textAlign="center",t.textBaseline="middle";const w=h.text.split(""),H=h.fontSize*2.4,b=-(w.length-1)*H/2;w.forEach((s,a)=>{t.fillText(s,0,b+a*H)})}else t.rotate(h.rotation*Math.PI/180),t.font=`${h.fontSize*2}px ${h.fontFamily}, Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji`,t.fillStyle=h.color,t.textAlign="center",t.textBaseline="middle",t.fillText(h.text,0,0);t.restore()}),setTimeout(()=>{const h=document.createElement("a");h.download="ì¸í™”ì‚¬ì§„.png",h.href=n.toDataURL("image/png",1),h.click(),n.width=l,n.height=y,t.putImageData(m,0,0)},100)})}},[u,S,C]),_=x.useCallback(()=>{if(D.current){const n=D.current,t=n.getContext("2d");if(!t)return;const m=t.getImageData(0,0,n.width,n.height),l=C?2400:1600,y=C?1600:2400;let v,g;C?(v=1600,g=2400):(v=l,g=y),n.width=v,n.height=g,t.clearRect(0,0,v,g),t.fillStyle="#ffffff",t.fillRect(0,0,v,g);const A=()=>{C&&(t.save(),t.translate(v/2,g/2),t.rotate(Math.PI/2),t.translate(-l/2,-y/2)),S.forEach(s=>{t.save();const a=s.x*l,i=s.y*y;if(t.translate(a,i),C){t.font=`${s.fontSize*2}px ${s.fontFamily}, Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji`,t.fillStyle=s.color,t.textAlign="center",t.textBaseline="middle";const o=s.text.split(""),d=s.fontSize*2.4,c=-(o.length-1)*d/2;o.forEach((I,E)=>{t.fillText(I,0,c+E*d)})}else t.rotate(s.rotation*Math.PI/180),t.font=`${s.fontSize*2}px ${s.fontFamily}, Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji`,t.fillStyle=s.color,t.textAlign="center",t.textBaseline="middle",t.fillText(s.text,0,0);t.restore()}),C&&t.restore();const p=n.toDataURL("image/png",1);document.querySelectorAll('[id^="print-"]').forEach(s=>s.remove());const H=document.createElement("img");H.id="print-image-single",H.src=p,H.style.cssText=`
          position: fixed;
          top: -9999px;
          left: -9999px;
          width: 100%;
          height: auto;
          z-index: 9999;
          display: none;
        `;const b=document.createElement("style");b.id="print-style-single",b.textContent=`
          @media print {
            body * {
              visibility: hidden !important;
              display: none !important;
            }
            #print-image-single {
              visibility: visible !important;
              display: block !important;
              position: fixed !important;
              top: 0 !important;
              left: 0 !important;
              width: 100% !important;
              height: auto !important;
              max-width: none !important;
              max-height: none !important;
              margin: 0 !important;
              padding: 0 !important;
              page-break-inside: avoid;
              z-index: 99999 !important;
            }
            @page {
              margin: 0;
              size: portrait;
            }
          }
        `,document.head.appendChild(b),document.body.appendChild(H),H.onload=()=>{setTimeout(()=>{window.print(),setTimeout(()=>{H.remove(),b.remove(),n.width=l,n.height=y,t.putImageData(m,0,0)},1e3)},100)}};if(u.length===0){A();return}let h=0;const M=u.length;u.forEach(p=>{const w=new Image;w.crossOrigin="anonymous",w.onload=()=>{t.save(),C&&(t.translate(v/2,g/2),t.rotate(Math.PI/2),t.translate(-l/2,-y/2));const H=p.slotX*l,b=p.slotY*y,s=p.slotWidth*l,a=p.slotHeight*y;t.beginPath(),t.rect(H,b,s,a),t.clip();const i=H+s/2+p.x*s,o=b+a/2+p.y*a;t.translate(i,o),t.rotate(p.rotation*Math.PI/180);const d=w.width*p.scale,c=w.height*p.scale;t.drawImage(w,-d/2,-c/2,d,c),t.restore(),h++,h===M&&A()},w.onerror=()=>{console.error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:",p.src),h++,h===M&&A()},w.src=p.src})}},[u,S,C]),J=x.useCallback(()=>{U(),k(!1)},[U]);return x.useEffect(()=>{try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(n){console.error("AdSense error:",n)}},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-xl md:text-3xl font-bold text-gray-900",children:"ì˜¤ìš°ì˜ˆ ì…€í”„ìŠ¤íŠœë””ì˜¤ ì‚¬ì§„ íŽ¸ì§‘ê¸°"}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsxs("button",{onClick:O,className:"bg-green-600 hover:bg-green-700 text-white px-3 sm:px-6 py-2 rounded-lg font-medium transition-colors whitespace-nowrap cursor-pointer text-sm sm:text-base",children:[e.jsx("i",{className:"ri-download-line mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"íŒŒì¼ë¡œ ì €ìž¥í•˜ê¸°"}),e.jsx("span",{className:"sm:hidden",children:"ì €ìž¥"})]}),e.jsxs("button",{onClick:_,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 sm:px-6 py-2 rounded-lg font-medium transition-colors whitespace-nowrap cursor-pointer text-sm sm:text-base",children:[e.jsx("i",{className:"ri-printer-line mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"ì¸ì‡„í•˜ê¸°"}),e.jsx("span",{className:"sm:hidden",children:"ì¸ì‡„"})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"ë ˆì´ì•„ì›ƒ ì„ íƒ"}),e.jsx(se,{layouts:K,selectedLayout:r,onLayoutChange:B})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"ì‚¬ì§„ ì—…ë¡œë“œ"}),e.jsx(te,{onUpload:F})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"íŽ¸ì§‘ ëª¨ë“œ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>k(!1),className:`w-full px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap cursor-pointer ${f?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:[e.jsx("i",{className:"ri-image-line mr-2"}),"ì‚¬ì§„ íŽ¸ì§‘"]}),e.jsxs("button",{onClick:J,className:"w-full px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap cursor-pointer bg-gray-100 text-gray-700 hover:bg-gray-200",children:[e.jsx("i",{className:"ri-text mr-2"}),"í…ìŠ¤íŠ¸ ì¶”ê°€"]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:r.name}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Z,{ref:D,photos:u,texts:S,layout:r,isTextMode:f,onAddText:U,onUpdatePhoto:z,onUpdateText:Y,showGuides:!0})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"íŽ¸ì§‘ ë„êµ¬"}),u.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-2 text-gray-700",children:"ì‚¬ì§„ ëª©ë¡"}),e.jsx("div",{className:"space-y-2",children:u.sort((n,t)=>Math.abs(n.slotY-t.slotY)<.01?n.slotX-t.slotX:n.slotY-t.slotY).map((n,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["ì‚¬ì§„ ",t+1]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>z(n.id,{scale:n.scale+.01}),className:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"í™•ëŒ€",children:e.jsx("i",{className:"ri-zoom-in-line"})}),e.jsx("button",{onClick:()=>z(n.id,{scale:Math.max(n.scale-.01,.01)}),className:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"ì¶•ì†Œ",children:e.jsx("i",{className:"ri-zoom-out-line"})}),e.jsx("button",{onClick:()=>$(n.id),className:"text-purple-500 hover:text-purple-700 cursor-pointer",title:"ëª¨ë“  ì‚¬ì§„ì— ë™ì¼í•œ í™•ëŒ€ìœ¨ ì ìš©",children:e.jsx("i",{className:"ri-search-line"})}),e.jsx("button",{onClick:()=>L(n.id),className:"text-green-500 hover:text-green-700 cursor-pointer",title:"í”„ë ˆìž„ì— ë§žì¶¤",children:e.jsx("i",{className:"ri-restart-line"})}),e.jsx("button",{onClick:()=>X(n.id),className:"text-red-500 hover:text-red-700 cursor-pointer",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]},n.id))})]}),S.length>0&&e.jsx(ne,{texts:S,onUpdateText:Y,onDeleteText:V})]})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("div",{className:"text-center text-xs text-gray-400 mb-2",children:"Advertisement"}),e.jsx("ins",{className:"adsbygoogle",style:{display:"block"},"data-ad-client":"ca-pub-9037816875196395","data-ad-slot":"auto","data-ad-format":"auto","data-full-width-responsive":"true"})]})})]})}export{le as default};
